<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شجرة العائلة للرسل والأنبياء</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-green: #76c02a;
            --dark-green: #4a8a18;
            --yellow-banner: #fbc02d;
            --text-color: #333;
            --light-bg: #f9f9f9;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fff;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 650px;
            margin: 0 auto;
            padding: 10px;
        }

        .top-banner {
            background-color: var(--yellow-banner);
            color: white;
            text-align: center;
            padding: 10px 0;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .hero-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }

        .hero-image { flex: 1; max-width: 45%; }
        .hero-text { flex: 1; font-size: 1.1rem; text-align: right; font-weight: 500; }

        .product-img {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .red-note-container { text-align: center; width: 100%; margin: 15px 0; }
        .red-note { color: red; font-weight: bold; font-size: 1.2rem; }

        .btn-order {
            background: linear-gradient(to bottom, #86d630, #5a9e1e);
            color: white;
            text-align: center;
            display: block;
            padding: 15px;
            margin: 20px auto;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            width: 90%;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            border: none;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            10% { transform: translateX(-3px) rotate(-1deg); }
            20% { transform: translateX(3px) rotate(1deg); }
            100% { transform: translateX(0); }
        }
        .shake-btn { animation: shake 2.5s infinite ease-in-out; }

        .specs-container { display: flex; align-items: flex-start; gap: 20px; margin: 30px 0; }
        .specs { flex: 1; }
        .spec-item { display: flex; align-items: center; margin-bottom: 10px; }
        .spec-item i { color: green; margin-left: 10px; }
        .sources-list { background-color: #fcfcfc; padding: 20px; border-radius: 10px; font-size: 0.9rem; border: 1px solid #eee; }

        .features {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            text-align: center;
            margin: 30px 0;
            font-size: 0.75rem;
        }
        .features i { color: var(--primary-green); font-size: 1.5rem; margin-bottom: 5px; }

        .order-form-container {
            border: 3px solid #fbc02d;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
            background-color: #fffef9;
        }
        
        .quantity-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .qty-card {
            cursor: pointer;
            border: 2px solid #ddd;
            padding: 15px 10px;
            border-radius: 12px;
            flex: 1;
            background: white;
            transition: 0.3s;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .qty-card input { display: none; }

        .price-display-area { margin: 20px 0; }
        .price-tag { font-size: 2.8rem; font-weight: bold; color: #333; line-height: 1; }
        .old-price { text-decoration: line-through; color: #999; font-size: 1.2rem; margin-bottom: 5px; display: block; }

        /* Form Inputs */
        .input-field {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            text-align: right;
            font-size: 1rem;
            background-color: white;
        }

        select.input-field {
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
        }

        @media (max-width: 480px) {
            .hero-section { flex-direction: column; }
            .hero-image { max-width: 100%; }
            .hero-text { text-align: center; }
            .quantity-selector { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="top-banner">توصيل مجاني والدفع عند الإستلام </div>

<div class="container">
    <div class="product-header" style="text-align: center; padding: 10px 0;">
        <h2>شجرة العائلة للرسل والأنبياء عليهم الصلاة والسلام</h2>
        <div style="color: #fbc02d; font-size: 1.6rem;">★★★★★</div>
    </div>

    <div class="hero-section">
        <div class="hero-image">
            <img src="testTree.png" alt="Family Tree" class="product-img">
        </div>
        <div class="hero-text">
            يوضح هذا الرسم البياني شجرة عائلة جميع الأنبياء الإسلاميين الخمسة والعشرين المذكورين في القرآن الكريم، من آدم عليه السلام إلى محمد صلى الله عليه وسلم. التصميم رائع، معقد، وسهل المتابعة.
        </div>
    </div>

    <div class="red-note-container">
        <p class="red-note">تنبيه: المخطوطة بدون إطار</p>
    </div>

    <a href="#order-form" class="btn-order shake-btn">إضغط هنا لطلب المنتج</a>

    <div class="specs-container">
        <div class="specs">
            <h3>المواصفات</h3>
            <div class="spec-item"><i class="fa fa-check-square"></i> الحجم الكبير: 60 × 90 سنتيمتر</div>
            <div class="spec-item"><i class="fa fa-check-square"></i> اللغة: الإنجليزية والعربية</div>
            <div class="spec-item"><i class="fa fa-check-square"></i> نوع الورق: ورق مقوى فني</div>
        </div>
    </div>

    <div class="sources-list">
        <h3>الكتب والمراجع:</h3>
        <ol style="columns: 2; padding-right: 20px;">
            <li>القرآن الكريم</li>
            <li>صحيح البخاري</li>
            <li>تاريخ الأمم</li>
            <li>البداية والنهاية</li>
            <li>قصص الأنبياء</li>
            <li>تفسير ابن كثير</li>
            <li>السيرة النبوية</li>
            <li>الكامل في التاريخ</li>
        </ol>
    </div>

    <div class="features">
        <div><i class="fa fa-truck"></i><br>توصيل سريع</div>
        <div><i class="fa fa-check-circle"></i><br>جودة عالية</div>
        <div><i class="fa fa-shield-alt"></i><br>ضمان المنتج</div>
        <div><i class="fa fa-wallet"></i><br>دفع عند الاستلام</div>
    </div>

    <div id="order-form" class="order-form-container">
        <h3 style="margin-bottom: 5px;">إختر الكمية المطلوبة</h3>
        <p style="color: #666; margin-top: 0;">كلما طلبت أكثر، زاد الخصم!</p>

        <div class="quantity-selector">
            <label class="qty-card" id="card-1">
                <input type="radio" name="qty_select" value="1" checked onclick="updatePrice(1, 3900, 0)">
                <span>1 قطعة</span>
            </label>
            <label class="qty-card" id="card-2">
                <input type="radio" name="qty_select" value="2" onclick="updatePrice(2, 6900, 7800)">
                <span>2 قطع</span>
            </label>
            <label class="qty-card" id="card-3">
                <input type="radio" name="qty_select" value="3" onclick="updatePrice(3, 9900, 11700)">
                <span>3 قطع</span>
            </label>
        </div>

        <div class="price-display-area">
            <span id="old-price-main" class="old-price" style="display: none;">0 دج</span>
            <div class="price-tag" id="display-price">3900 دج</div>
            <p style="color: blue; font-size: 0.9rem; margin-top: 10px;">تذكير! نبيع المخطوطة بدون إطار</p>
        </div>
    
    <form id="purchase-form">

            <!-- https://script.google.com/macros/s/AKfycbx2Ur6jMHX9QcW6nOMVcAV4DVQ8DsmXOIbFb0ZfcVlw8xNPHg8twrIx8hd5nNdqfy5q/exec -->
            <input type="hidden" name="quantity" id="final-qty" value="1">
            <input type="hidden" name="price" id="price-hidden">
            
            <input type="text" name="name" class="input-field" placeholder="الإسم الكامل" required>
            <input type="tel" name="phone" class="input-field" placeholder="رقم الهاتف" required>
            
            <select id="wilaya" name="wilaya" class="input-field" required onchange="updateBaladiyat()">
                <option value="" disabled selected>إختر الولاية</option>
            </select>

            <select id="baladiya" name="baladiya" class="input-field" required disabled>
              <option value="" disabled selected>إختر البلدية</option>
            </select>

            <button type="submit" class="btn-order shake-btn" style="width: 100%; border: none; cursor: pointer; margin-top: 10px;">تأكيد الطلب الآن</button>
        </form>
    </div>
</div>
<iframe name="hidden_iframe" style="display:none;"></iframe>

<script>

let submitted = false;

document.getElementById("purchase-form").addEventListener("submit", function(e) {
    e.preventDefault();

    const submitBtn = e.target.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.innerText = "جاري الإرسال...";

    // Create a URL-encoded data object
    const formData = new URLSearchParams();
    formData.append("name", document.querySelector('input[name="name"]').value);
    formData.append("phone", document.querySelector('input[name="phone"]').value);
    formData.append("wilaya", document.getElementById("wilaya").value);
    formData.append("baladiya", document.getElementById("baladiya").value);
    formData.append("quantity", document.getElementById("final-qty").value);
    formData.append("price", document.getElementById("display-price").innerText);

    // PASTE YOUR NEW DEPLOYMENT URL HERE
    const scriptURL = "https://script.google.com/macros/s/AKfycby9sQZ38Zn3qMi8MZx2pVD-I_AdMp0okiJHth6RpIrJ/dev";

    fetch(scriptURL, {
        method: "POST",
        mode: "no-cors", 
        body: formData // Sending as URLSearchParams
    })
    .then(() => {
        alert("✅ تم إرسال طلبك بنجاح");
        document.getElementById("purchase-form").reset();
        submitBtn.disabled = false;
        submitBtn.innerText = "تأكيد الطلب الآن";
    })
    .catch((error) => {
        alert("❌ حدث خطأ، حاول مرة أخرى");
        submitBtn.disabled = false;
        submitBtn.innerText = "تأكيد الطلب الآن";
    });
});


    // JSON Data for Algeria (Sample - Add more as needed)
    const algeriaData = {
        "01-أدرار": ["أدرار", "أكابلي", "أولف", "بودة", "فنوغيل", "إن زغمير", "أولاد أحمد تيمي", "رقان", "سالي", "سبع", "تمنطيط", "تمست", "تيمكتن", "تيت", "تسابيت", "زاوية كنتة"],
        "02-الشلف": ["أبو الحسن", "عين مران", "بنايرية", "بني بوعتاب", "بني حواء", "بني راشد", "بوقادير", "بوزغاية", "بريرة", "الشطية", "الشلف", "الظهرة", "الحجاج", "الكريمية", "المرسى", "هرشون", "حرنفة", "الأبيض مجاجة", "مصدق", "وادي الفضة", "وادي قوسين", "وادي سلي", "أولاد عباس", "أولاد بن عبد القادر", "أولاد فارس", "أم الدروع", "سنجاس", "سيدي عبد الرحمن", "سيدي عكاشة", "صبحة", "تاجنة", "تلعصة", "تاوقريت", "تنس", "الزبوجة"],
        "03-الأغواط": ["أفلو", "عين ماضي", "عين سيدي علي", "بيضاء", "بن ناصر بن شهرة", "بريدة", "العسافية", "الغيشة", "الحويطة", "قلتة سيدي سعد", "حاج مشري", "حاسي الدلاعة", "حاسي الرمل", "الخنق", "قصر الحيران", "الأغواط", "وادي مزي", "وادي مرة", "سبقاق", "سيدي بوزيد", "سيدي مخلوف", "تاجموت", "تاجرونة", "تاويالة"],
        
        // Note: You can expand this list to all 58 Wilayas
    };

    const wilayaSelect = document.getElementById('wilaya');
    const baladiyaSelect = document.getElementById('baladiya');

    // Populate Wilayas
    for (let wilaya in algeriaData) {
        let opt = document.createElement('option');
        opt.value = wilaya;
        opt.innerHTML = wilaya;
        wilayaSelect.appendChild(opt);
    }

    function updateBaladiyat() {
        const selectedWilaya = wilayaSelect.value;
        baladiyaSelect.innerHTML = '<option value="" disabled selected>إختر البلدية</option>';
        
        if (selectedWilaya) {
            baladiyaSelect.disabled = false;
            algeriaData[selectedWilaya].forEach(baladiya => {
                let opt = document.createElement('option');
                opt.value = baladiya;
                opt.innerHTML = baladiya;
                baladiyaSelect.appendChild(opt);
            });
        } else {
            baladiyaSelect.disabled = true;
        }
    }

    function updatePrice(qty, price, oldPrice) {

        document.getElementById("price-hidden").value =
        document.getElementById("display-price").innerText;

        document.getElementById('display-price').innerText = price + " دج";
        document.getElementById('final-qty').value = qty;

        const oldPriceElement = document.getElementById('old-price-main');
        if (oldPrice > 0) {
            oldPriceElement.innerText = oldPrice + " دج";
            oldPriceElement.style.display = "block";
        } else {
            oldPriceElement.style.display = "none";
        }

        for(let i=1; i<=3; i++) {
            const card = document.getElementById('card-' + i);
            if(i === qty) {
                card.style.borderColor = "var(--primary-green)";
                card.style.backgroundColor = "#f7fff0";
                card.style.transform = "scale(1.05)";
            } else {
                card.style.borderColor = "#ddd";
                card.style.backgroundColor = "white";
                card.style.transform = "scale(1)";
            }
        }
    }

    updatePrice(1, 3900, 0);
</script>

</body>
</html>
